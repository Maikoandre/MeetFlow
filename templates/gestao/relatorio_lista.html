{% extends 'base.html' %} {% block content %}
<div class="container mt-5">
  {% if messages %} {% for message in messages %}
  <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  {% endfor %} {% endif %}

  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h3>Histórico de Relatórios</h3>
      <span class="text-muted">Evento: {{ evento.titulo }}</span>
    </div>
    <div>
      <a
        href="{% url 'gerar_relatorio' evento.id %}"
        class="btn btn-primary me-2"
      >
        <i class="mdi mdi-chart-bar"></i> Gerar Novo
      </a>
      <a
        href="{% url 'detalhes_evento' evento.id %}"
        class="btn btn-outline-secondary"
      >
        Voltar ao Evento
      </a>
    </div>
  </div>

  <div class="card shadow">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="bg-light">
            <tr>
              <th>Data de Geração</th>
              <th class="text-center">Total Inscritos</th>
              <th class="text-center">Total Presentes</th>
              <th class="text-center">Adesão (%)</th>
              <th class="text-end">Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for relatorio in relatorios %}
            <tr>
              <td>
                <i class="mdi mdi-clock-outline text-muted me-1"></i>
                {{ relatorio.data_geracao|date:"d/m/Y H:i" }}
              </td>
              <td class="text-center">
                <span class="badge bg-secondary"
                  >{{ relatorio.total_inscritos }}</span
                >
              </td>
              <td class="text-center">
                <span class="badge bg-success text-white"
                  >{{ relatorio.total_presentes }}</span
                >
              </td>
              <td class="text-center">
                {% if relatorio.total_inscritos > 0 %} {% widthratio
                relatorio.total_presentes relatorio.total_inscritos 100 %}% {%
                else %} 0% {% endif %}
              </td>
              <td class="text-end">
                <a
                  href="{% url 'detalhes_relatorio' relatorio.pk %}"
                  class="btn btn-sm btn-info text-white"
                  title="Ver Detalhes Completo"
                >
                  <i class="mdi mdi-eye"></i> Ver
                </a>
              </td>
              <td class="text-end">
                <a
                  href="{% url 'detalhes_relatorio' relatorio.pk %}"
                  class="btn btn-sm btn-info text-white me-1"
                  title="Ver"
                >
                  <i class="mdi mdi-eye"></i>
                </a>

                <a
                  href="{% url 'editar_relatorio' relatorio.pk %}"
                  class="btn btn-sm btn-warning text-white me-1"
                  title="Editar Manualmente"
                >
                  <i class="mdi mdi-pencil"></i>
                </a>

                <a
                  href="{% url 'deletar_relatorio' relatorio.pk %}"
                  class="btn btn-sm btn-danger text-white"
                  title="Apagar"
                >
                  <i class="mdi mdi-delete"></i>
                </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="text-center py-5 text-muted">
                <i
                  class="mdi mdi-file-document-outline"
                  style="font-size: 2rem"
                ></i
                ><br />
                Nenhum relatório gerado para este evento ainda.
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
