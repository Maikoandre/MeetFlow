{% extends 'base.html' %} 
{% block title %}Dashboard - {{ perfil.get_tipo_display }}{% endblock %} 

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  .dashboard-card {
    border: none;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: transform 0.2s;
    margin-bottom: 24px;
    padding: 10px; /* Mais preenchimento */
  }
  .dashboard-card:hover {
    transform: translateY(-5px);
  }
  /* AUMENTADO: Ícones gigantes */
  .card-icon {
    font-size: 4.5rem; 
    opacity: 0.8;
  }
  /* AUMENTADO: Números de estatísticas */
  .stat-value {
    font-size: 3.5rem;
    font-weight: 800;
    margin-bottom: 5px;
    line-height: 1.2;
  }
  /* AUMENTADO: Texto abaixo do número */
  .stat-label {
    color: #6c757d;
    font-size: 1.2rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .chart-container {
    position: relative;
    height: 350px; /* Um pouco mais alto para acompanhar o texto */
    width: 100%;
  }
  /* NOVA CLASSE: Para aumentar tabelas */
  .table-big td, .table-big th {
    font-size: 1.15rem;
    vertical-align: middle;
    padding: 15px;
  }
  /* NOVA CLASSE: Títulos de seção */
  .section-title {
    font-size: 1.6rem;
    font-weight: bold;
    margin-bottom: 1.5rem;
  }
</style>

<div class="row mb-5">
  <div class="col-12">
    <div class="d-flex align-items-center justify-content-between">
      <div>
        <h2 class="mb-2 font-weight-bold" style="font-size: 2.8rem;">Olá, {{ perfil.nome }}!</h2>
        <p class="text-muted mb-0" style="font-size: 1.3rem;">
          Bem-vindo ao seu painel de {{ perfil.get_tipo_display }}
        </p>
      </div>
      <div class="d-none d-md-block">
        <span class="badge badge-pill badge-primary px-4 py-3" style="font-size: 1.1rem;">
          {{ perfil.get_tipo_display }}
        </span>
      </div>
    </div>
  </div>
</div>

{% if perfil.tipo == 'admin' %}
<div class="row">
  <div class="col-md-6"> <div class="card dashboard-card">
      <div class="card-body d-flex align-items-center justify-content-between">
        <div>
          <h2 class="stat-value text-primary">{{ total_usuarios }}</h2>
          <p class="stat-label">Total de Usuários</p>
        </div>
        <i class="mdi mdi-account-group card-icon text-primary"></i>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card dashboard-card">
      <div class="card-body d-flex align-items-center justify-content-between">
        <div>
          <h2 class="stat-value text-success">{{ total_eventos }}</h2>
          <p class="stat-label">Total de Eventos</p>
        </div>
        <i class="mdi mdi-calendar-check card-icon text-success"></i>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-8">
    <div class="card dashboard-card">
      <div class="card-body">
        <h3 class="card-title section-title">Eventos por Mês</h3>
        <div class="chart-container">
          <canvas id="adminEventsChart"></canvas>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card dashboard-card">
      <div class="card-body">
        <h3 class="card-title section-title">Distribuição</h3>
        <div class="chart-container">
          <canvas id="adminUsersChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <div class="card dashboard-card">
      <div class="card-body">
        <h3 class="card-title section-title">Gerenciar Aprovações</h3>
        <div class="table-responsive">
          <table class="table table-hover table-big">
            <thead class="thead-light">
              <tr>
                <th>Evento</th>
                <th>Organizador</th>
                <th>Data</th>
                <th>Status</th>
                <th>Ação</th>
              </tr>
            </thead>
            <tbody>
              {% for evento in lista_pendentes %}
              <tr>
                <td><strong>{{ evento.titulo }}</strong></td>
                <td>{{ evento.organizador_nome }}</td>
                <td>{{ evento.data|date:"d/m/Y" }}</td>
                <td><span class="badge badge-warning" style="font-size: 0.9rem;">Pendente</span></td>
                <td>
                  <a href="{% url 'aprovar_evento' evento.pk %}" class="btn btn-success btn-rounded font-weight-bold">
                    <i class="mdi mdi-check"></i> Aprovar
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center text-muted">
                  Nenhum evento pendente.
                </td>
              </tr>
              {% endfor %} 
              
              {% for evento in lista_a_publicar %}
              <tr>
                <td><strong>{{ evento.titulo }}</strong></td>
                <td>{{ evento.organizador_nome }}</td>
                <td>{{ evento.data|date:"d/m/Y" }}</td>
                <td><span class="badge badge-info" style="font-size: 0.9rem;">Aprovado</span></td>
                <td>
                  <a href="{% url 'publicar_evento' evento.pk %}" class="btn btn-primary btn-rounded font-weight-bold">
                    <i class="mdi mdi-publish"></i> Publicar
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Admin Charts
  new Chart(document.getElementById('adminEventsChart'), {
      type: 'bar',
      data: {
          labels: {{ chart_eventos_labels|safe }},
          datasets: [{
              label: 'Novos Eventos',
              data: {{ chart_eventos_data|safe }},
              backgroundColor: 'rgba(54, 162, 235, 0.6)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1
          }]
      },
      options: { responsive: true, maintainAspectRatio: false }
  });

  new Chart(document.getElementById('adminUsersChart'), {
      type: 'doughnut',
      data: {
          labels: {{ chart_usuarios_labels|safe }},
          datasets: [{
              data: {{ chart_usuarios_data|safe }},
              backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc'],
          }]
      },
      options: { responsive: true, maintainAspectRatio: false }
  });
</script>

{% elif perfil.tipo == 'organizador' %}
<div class="row">
  <div class="col-md-12"> <div class="card dashboard-card">
      <div class="card-body d-flex align-items-center justify-content-between">
        <div>
          <h2 class="stat-value text-success">{{ total_inscritos }}</h2>
          <p class="stat-label">Total de Inscritos (Todos Eventos)</p>
        </div>
        <i class="mdi mdi-account-multiple-check card-icon text-success"></i>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-8">
    <div class="card dashboard-card">
      <div class="card-body">
        <h3 class="card-title section-title">Inscritos por Evento</h3>
        <div class="chart-container">
          <canvas id="orgInscricoesChart"></canvas>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card dashboard-card">
      <div class="card-body">
        <h3 class="card-title section-title">Status Inscrições</h3>
        <div class="chart-container">
          <canvas id="orgStatusChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <div class="card dashboard-card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="card-title section-title mb-0">Meus Eventos Recentes</h3>
          <a href="{% url 'gerenciar_eventos' %}" class="btn btn-outline-primary btn-lg">Ver Todos</a>
        </div>
        <div class="table-responsive">
          <table class="table table-hover table-big">
            <thead>
              <tr>
                <th>Evento</th>
                <th>Data</th>
                <th>Status</th>
                <th>Inscritos</th>
              </tr>
            </thead>
            <tbody>
              {% for evento in meus_eventos|slice:":5" %}
              <tr>
                <td><strong>{{ evento.titulo }}</strong></td>
                <td>{{ evento.data|date:"d/m/Y" }}</td>
                <td>
                  {% if evento.publicado %}
                  <span class="badge badge-success" style="font-size: 0.9rem;">Publicado</span>
                  {% elif evento.aprovado %}
                  <span class="badge badge-info" style="font-size: 0.9rem;">Aprovado</span>
                  {% else %}
                  <span class="badge badge-warning" style="font-size: 0.9rem;">Em Análise</span>
                  {% endif %}
                </td>
                <td style="font-size: 1.3rem; font-weight: bold;">{{ evento.inscricoes.count }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="4" class="text-center">
                  Nenhum evento encontrado.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Organizer Charts
  new Chart(document.getElementById('orgInscricoesChart'), {
      type: 'bar',
      data: {
          labels: {{ chart_inscricoes_labels|safe }},
          datasets: [{
              label: 'Inscritos',
              data: {{ chart_inscricoes_data|safe }},
              backgroundColor: '#1cc88a',
          }]
      },
      options: { responsive: true, maintainAspectRatio: false }
  });

  new Chart(document.getElementById('orgStatusChart'), {
      type: 'pie',
      data: {
          labels: {{ chart_status_labels|safe }},
          datasets: [{
              data: {{ chart_status_data|safe }},
              backgroundColor: ['#f6c23e', '#1cc88a', '#e74a3b'],
          }]
      },
      options: { responsive: true, maintainAspectRatio: false }
  });
</script>

{% else %}
<div class="row">
  <div class="col-md-6">
    <div class="card dashboard-card">
      <div class="card-body d-flex align-items-center justify-content-between">
        <div>
          <h2 class="stat-value text-primary">{{ total_inscricoes }}</h2>
          <p class="stat-label">Minhas Inscrições</p>
        </div>
        <i class="mdi mdi-ticket-confirmation card-icon text-primary"></i>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card dashboard-card bg-gradient-info text-white">
      <div class="card-body d-flex align-items-center justify-content-between">
        <div>
          <h2 class="stat-value text-white">{{ eventos_confirmados }}</h2>
          <p class="mb-0 text-white-50 stat-label" style="color: rgba(255,255,255,0.8) !important;">Confirmados</p>
        </div>
        <i class="mdi mdi-check-decagram card-icon text-white"></i>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-4">
    <div class="card dashboard-card">
      <div class="card-body">
        <h3 class="card-title section-title">Minha Situação</h3>
        <div class="chart-container">
          <canvas id="participantStatusChart"></canvas>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-8">
    <div class="card dashboard-card">
      <div class="card-body">
        <h3 class="card-title section-title">Próximos Eventos</h3>
        <div class="table-responsive">
          <table class="table table-hover table-big">
            <thead>
              <tr>
                <th>Evento</th>
                <th>Data</th>
                <th>Local</th>
                <th>Status</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              {% for inscricao in minhas_inscricoes %}
              <tr>
                <td><strong>{{ inscricao.evento.titulo }}</strong></td>
                <td>{{ inscricao.evento.data|date:"d/m/Y" }}</td>
                <td>{{ inscricao.evento.local }}</td>
                <td>
                  {% if inscricao.status == 'confirmado' %}
                  <span class="badge badge-success" style="font-size: 0.9rem;">Confirmado</span>
                  {% elif inscricao.status == 'pendente' %}
                  <span class="badge badge-warning" style="font-size: 0.9rem;">Pendente</span>
                  {% else %}
                  <span class="badge badge-danger" style="font-size: 0.9rem;">Cancelado</span>
                  {% endif %}
                </td>
                <td>
                  {% if inscricao.status != 'confirmado' %}
                  <a href="{% url 'confirmar_inscricao' inscricao.id %}" class="btn btn-success btn-sm btn-icon-text p-2" title="Confirmar">
                    <i class="mdi mdi-check" style="font-size: 1.2rem;"></i>
                  </a>
                  {% endif %}
                  <a href="{% url 'deletar_inscricao' inscricao.id %}" class="btn btn-danger btn-sm btn-icon-text p-2" title="Cancelar">
                    <i class="mdi mdi-delete" style="font-size: 1.2rem;"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center py-4">
                  <p class="text-muted mb-3" style="font-size: 1.2rem;">
                    Você não está inscrito em nenhum evento.
                  </p>
                  <a href="{% url 'eventos' %}" class="btn btn-primary btn-lg">Ver Eventos Disponíveis</a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  new Chart(document.getElementById('participantStatusChart'), {
      type: 'doughnut',
      data: {
          labels: {{ chart_minhas_status_labels|safe }},
          datasets: [{
              data: {{ chart_minhas_status_data|safe }},
              backgroundColor: ['#f6c23e', '#1cc88a', '#e74a3b'],
          }]
      },
      options: { responsive: true, maintainAspectRatio: false }
  });
</script>

{% endif %} 
{% endblock %}
