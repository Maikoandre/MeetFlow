{% extends 'base.html' %} {% block title %}Dashboard - {{
perfil.get_tipo_display }}{% endblock %} {% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  .dashboard-card {
    border: none;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: transform 0.2s;
    margin-bottom: 24px;
  }
  .dashboard-card:hover {
    transform: translateY(-5px);
  }
  .card-icon {
    font-size: 2.5rem;
    opacity: 0.8;
  }
  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0;
  }
  .stat-label {
    color: #6c757d;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .chart-container {
    position: relative;
    height: 300px;
    width: 100%;
  }
</style>

<div class="row mb-4">
  <div class="col-12">
    <div class="d-flex align-items-center justify-content-between">
      <div>
        <h3 class="mb-1 font-weight-bold">Olá, {{ perfil.nome }}!</h3>
        <p class="text-muted mb-0">
          Bem-vindo ao seu painel de {{ perfil.get_tipo_display }}
        </p>
      </div>
      <div class="d-none d-md-block">
        <span class="badge badge-pill badge-primary px-3 py-2"
          >{{ perfil.get_tipo_display }}</span
        >
      </div>
    </div>
  </div>
</div>

{% if perfil.tipo == 'admin' %}
<!-- ADMIN DASHBOARD -->
<div class="row">
  <!-- Stats Cards -->
  <div class="col-md-4">
    <div class="card dashboard-card">
      <div class="card-body d-flex align-items-center justify-content-between">
        <div>
          <h2 class="stat-value text-primary">{{ total_usuarios }}</h2>
          <p class="stat-label">Total de Usuários</p>
        </div>
        <i class="mdi mdi-account-group card-icon text-primary"></i>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card dashboard-card">
      <div class="card-body d-flex align-items-center justify-content-between">
        <div>
          <h2 class="stat-value text-success">{{ total_eventos }}</h2>
          <p class="stat-label">Total de Eventos</p>
        </div>
        <i class="mdi mdi-calendar-check card-icon text-success"></i>
      </div>
    </div>
  </div>
</div>


<div class="row">
  <!-- Charts -->
  <div class="col-md-8">
    <div class="card dashboard-card">
      <div class="card-body">
        <h5 class="card-title">Eventos por Mês</h5>
        <div class="chart-container">
          <canvas id="adminEventsChart"></canvas>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card dashboard-card">
      <div class="card-body">
        <h5 class="card-title">Distribuição de Usuários</h5>
        <div class="chart-container">
          <canvas id="adminUsersChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <div class="card dashboard-card">
      <div class="card-body">
        <h5 class="card-title mb-4">Gerenciar Aprovações</h5>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="thead-light">
              <tr>
                <th>Evento</th>
                <th>Organizador</th>
                <th>Data</th>
                <th>Status</th>
                <th>Ação</th>
              </tr>
            </thead>
            <tbody>
              {% for evento in lista_pendentes %}
              <tr>
                <td><strong>{{ evento.titulo }}</strong></td>
                <td>{{ evento.organizador_nome }}</td>
                <td>{{ evento.data|date:"d/m/Y" }}</td>
                <td><span class="badge badge-warning">Pendente</span></td>
                <td>
                  <a
                    href="{% url 'aprovar_evento' evento.pk %}"
                    class="btn btn-success btn-sm btn-rounded"
                  >
                    <i class="mdi mdi-check"></i> Aprovar
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center text-muted">
                  Nenhum evento pendente.
                </td>
              </tr>
              {% endfor %} {% for evento in lista_a_publicar %}
              <tr>
                <td><strong>{{ evento.titulo }}</strong></td>
                <td>{{ evento.organizador_nome }}</td>
                <td>{{ evento.data|date:"d/m/Y" }}</td>
                <td><span class="badge badge-info">Aprovado</span></td>
                <td>
                  <a
                    href="{% url 'publicar_evento' evento.pk %}"
                    class="btn btn-primary btn-sm btn-rounded"
                  >
                    <i class="mdi mdi-publish"></i> Publicar
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
    <!-- htmlhint-disable -->
  // Admin Charts
  new Chart(document.getElementById('adminEventsChart'), {
      type: 'bar',
      data: {
          labels: {{ chart_eventos_labels|safe }},
          datasets: [{
              label: 'Novos Eventos',
              data: {{ chart_eventos_data|safe }},
              backgroundColor: 'rgba(54, 162, 235, 0.6)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1
          }]
      },
      options: { responsive: true, maintainAspectRatio: false }
  });

  new Chart(document.getElementById('adminUsersChart'), {
      type: 'doughnut',
      data: {
          labels: {{ chart_usuarios_labels|safe }},
          datasets: [{
              data: {{ chart_usuarios_data|safe }},
              backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc'],
          }]
      },
      options: { responsive: true, maintainAspectRatio: false }
  });
</script>

{% elif perfil.tipo == 'organizador' %}
<!-- ORGANIZER DASHBOARD -->
<div class="row">
  
  <div class="col-md-6">
    <div class="card dashboard-card">
      <div class="card-body d-flex align-items-center justify-content-between">
        <div>
          <h2 class="stat-value text-success">{{ total_inscritos }}</h2>
          <p class="stat-label">Total de Inscritos</p>
        </div>
        <i class="mdi mdi-account-multiple-check card-icon text-success"></i>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-8">
    <div class="card dashboard-card">
      <div class="card-body">
        <h5 class="card-title">Inscritos por Evento</h5>
        <div class="chart-container">
          <canvas id="orgInscricoesChart"></canvas>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card dashboard-card">
      <div class="card-body">
        <h5 class="card-title">Status das Inscrições</h5>
        <div class="chart-container">
          <canvas id="orgStatusChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <div class="card dashboard-card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h5 class="card-title mb-0">Meus Eventos Recentes</h5>
          <a
            href="{% url 'gerenciar_eventos' %}"
            class="btn btn-outline-primary btn-sm"
            >Ver Todos</a
          >
        </div>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Evento</th>
                <th>Data</th>
                <th>Status</th>
                <th>Inscritos</th>
              </tr>
            </thead>
            <tbody>
              {% for evento in meus_eventos|slice:":5" %}
              <tr>
                <td>{{ evento.titulo }}</td>
                <td>{{ evento.data|date:"d/m/Y" }}</td>
                <td>
                  {% if evento.publicado %}
                  <span class="badge badge-success">Publicado</span>
                  {% elif evento.aprovado %}
                  <span class="badge badge-info">Aprovado</span>
                  {% else %}
                  <span class="badge badge-warning">Em Análise</span>
                  {% endif %}
                </td>
                <td>{{ evento.inscricoes.count }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="4" class="text-center">
                  Nenhum evento encontrado.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Organizer Charts
  new Chart(document.getElementById('orgInscricoesChart'), {
      type: 'bar',
      data: {
          labels: {{ chart_inscricoes_labels|safe }},
          datasets: [{
              label: 'Inscritos',
              data: {{ chart_inscricoes_data|safe }},
              backgroundColor: '#1cc88a',
          }]
      },
      options: { responsive: true, maintainAspectRatio: false }
  });

  new Chart(document.getElementById('orgStatusChart'), {
      type: 'pie',
      data: {
          labels: {{ chart_status_labels|safe }},
          datasets: [{
              data: {{ chart_status_data|safe }},
              backgroundColor: ['#f6c23e', '#1cc88a', '#e74a3b'],
          }]
      },
      options: { responsive: true, maintainAspectRatio: false }
  });
</script>

{% else %}
<!-- PARTICIPANT DASHBOARD -->
<div class="row">
  <div class="col-md-6">
    <div class="card dashboard-card">
      <div class="card-body d-flex align-items-center justify-content-between">
        <div>
          <h2 class="stat-value text-primary">{{ total_inscricoes }}</h2>
          <p class="stat-label">Minhas Inscrições</p>
        </div>
        <i class="mdi mdi-ticket-confirmation card-icon text-primary"></i>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card dashboard-card bg-gradient-info text-white">
      <div class="card-body d-flex align-items-center justify-content-between">
        <div>
          <h2 class="stat-value text-white">{{ eventos_confirmados }}</h2>
          <p class="mb-0 text-white-50">Eventos Confirmados</p>
        </div>
        <i class="mdi mdi-check-decagram card-icon text-white"></i>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-4">
    <div class="card dashboard-card">
      <div class="card-body">
        <h5 class="card-title">Minha Situação</h5>
        <div class="chart-container">
          <canvas id="participantStatusChart"></canvas>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-8">
    <div class="card dashboard-card">
      <div class="card-body">
        <h5 class="card-title mb-4">Próximos Eventos</h5>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Evento</th>
                <th>Data</th>
                <th>Local</th>
                <th>Status</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              {% for inscricao in minhas_inscricoes %}
              <tr>
                <td><strong>{{ inscricao.evento.titulo }}</strong></td>
                <td>{{ inscricao.evento.data|date:"d/m/Y" }}</td>
                <td>{{ inscricao.evento.local }}</td>
                <td>
                  {% if inscricao.status == 'confirmado' %}
                  <span class="badge badge-success">Confirmado</span>
                  {% elif inscricao.status == 'pendente' %}
                  <span class="badge badge-warning">Pendente</span>
                  {% else %}
                  <span class="badge badge-danger">Cancelado</span>
                  {% endif %}
                </td>
                <td>
                  {% if inscricao.status != 'confirmado' %}
                  <a
                    href="{% url 'confirmar_inscricao' inscricao.id %}"
                    class="btn btn-success btn-sm btn-icon-text"
                    title="Confirmar"
                  >
                    <i class="mdi mdi-check"></i>
                  </a>
                  {% endif %}
                  <a
                    href="{% url 'deletar_inscricao' inscricao.id %}"
                    class="btn btn-danger btn-sm btn-icon-text"
                    title="Cancelar"
                  >
                    <i class="mdi mdi-delete"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center py-4">
                  <p class="text-muted mb-2">
                    Você não está inscrito em nenhum evento.
                  </p>
                  <a href="{% url 'eventos' %}" class="btn btn-primary btn-sm"
                    >Ver Eventos Disponíveis</a
                  >
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Participant Charts
  new Chart(document.getElementById('participantStatusChart'), {
      type: 'doughnut',
      data: {
          labels: {{ chart_minhas_status_labels|safe }},
          datasets: [{
              data: {{ chart_minhas_status_data|safe }},
              backgroundColor: ['#f6c23e', '#1cc88a', '#e74a3b'],
          }]
      },
      options: { responsive: true, maintainAspectRatio: false }
  });
</script>

{% endif %} {% endblock %}
