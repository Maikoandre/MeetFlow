{% extends 'base.html' %}
{% load static %}

{% block title %}Eventos - MeetFlow{% endblock %}

{% block content %}
<div class="page-header">
    <h3 class="page-title"> Calendário de Eventos </h3>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Dashboard</a></li>
            <li class="breadcrumb-item active" aria-current="page">Eventos</li>
        </ol>
    </nav>
</div>

<div class="row">
    <div class="col-lg-12 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">Eventos Disponíveis</h4>
                <p class="card-description"> Confira os próximos eventos e garanta sua vaga. </p>
                
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th> Evento </th>
                                <th> Data </th>
                                <th> Local </th>
                                <th> Status </th>
                                <th class="text-center"> Ações </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for evento in eventos %}
                            <tr>
                                <td class="font-weight-medium"> {{ evento.nome }} </td>
                                
                                <td> {{ evento.data|date:"d/m/Y" }} </td>
                                
                                <td> {{ evento.local }} </td>

                                <td>
                                    {% if evento.status == 'publicado' %}
                                        <label class="badge badge-success">Publicado</label>
                                    {% elif evento.status == 'pendente' %}
                                        <label class="badge badge-warning">Pendente</label>
                                    {% else %}
                                        <label class="badge badge-secondary">Rascunho</label>
                                    {% endif %}
                                </td>

                                <td class="text-center">
                                    
                                    {% if user.is_authenticated %}

                                        {% if user.is_superuser or user.is_staff %}
                                            
                                            <div class="btn-group" role="group">
                                                {% if evento.status == 'pendente' %}
                                                    <a href="{% url 'aprovar_evento' evento.id %}" class="btn btn-success btn-sm" title="Aprovar Evento">
                                                        <i class="icon-check"></i>
                                                    </a>
                                                {% endif %}
                                                
                                                {% if evento.status != 'publicado' %}
                                                    <a href="{% url 'publicar_evento' evento.id %}" class="btn btn-info btn-sm" title="Publicar Agora">
                                                        <i class="icon-cloud-upload"></i>
                                                    </a>
                                                {% endif %}

                                                <a href="{% url 'editar_evento' evento.id %}" class="btn btn-light btn-sm" title="Editar">
                                                    <i class="icon-pencil"></i>
                                                </a>
                                            </div>

                                        {% elif user == evento.organizador %}
                                            
                                            <a href="{% url 'editar_evento' evento.id %}" class="btn btn-primary btn-sm btn-icon-text">
                                                <i class="icon-pencil btn-icon-prepend"></i> Editar
                                            </a>
                                            <a href="{% url 'excluir_evento' evento.id %}" class="btn btn-danger btn-sm ml-2">
                                                <i class="icon-trash"></i>
                                            </a>

                                        {% else %}
                                            
                                            {% if user in evento.participantes.all %}
                                                <button class="btn btn-secondary btn-sm btn-icon-text" disabled>
                                                    <i class="icon-check btn-icon-prepend"></i> Inscrito
                                                </button>
                                            
                                            {% else %}
                                                <form method="POST" action="{% url 'inscrever_evento' evento.id %}" style="display:inline;">
                                                    {% csrf_token %}
                                                    <button type="submit" class="btn btn-outline-primary btn-sm btn-icon-text">
                                                        <i class="icon-user-follow btn-icon-prepend"></i> Inscrever-se
                                                    </button>
                                                </form>
                                            {% endif %}

                                        {% endif %}

                                    {% else %}
                                        <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-outline-primary btn-sm btn-icon-text">
                                            <i class="icon-user-follow btn-icon-prepend"></i> Inscrever-se
                                        </a>
                                    {% endif %}

                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center text-muted">Nenhum evento encontrado no momento.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}